<!DOCTYPE html>

<html lang="ja">

<head>
  <meta charset="utf-8">
  <title>WebGL作品集</title>
  <!--  <link href="css/style.css" rel="stylesheet">もういらない-->
  <link rel="stylesheet" href="style/index.css">
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/lib/three.min.js"></script>
  <script src="js/index_reset.js"></script>
  <script src="js/OrbitControls.js"></script>
  <!--    <script src="js/webgl1-1.js"></script>いらないよ-->
  <script src="js/liquidfun.js"></script>
  <script src="js/pixi.min.js"></script>
  <script src="js/webgl1-2.js"></script>
  <script src="js/config.js"></script>
  <link rel="stylesheet" href="css/leaflet.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" rel="stylesheet" />
  <!--  <script src="js/eegeo.js"></script>-->
  <script src="js/wrld.js"></script>
  <script data-main="../main" src="js/require.js"></script>
  <script src="js/index.js"></script>

</head>

<body>

  <main>

    <div class="cont">

      <div id="canvas1">
        <div id="container-lod">
          <div id="threejs-container">Loading...</div>
          <!--          <div id="share-container"></div>-->
          <div class="textFade">Welcome to WebGL</div>
          <div class="boxFade"></div>
          <div class="boxFade2"></div>
        </div>
        <div class="explain">
          <h2>作品①WebGLの基本　とにかくすごい3Dレンダリング</h2>
          <p id="equal">HTML + CSS + JS + WebGL = すごいWebページ！！！</p>
          <p id="equal2">ようこそ！　はじめまして。絶賛人気沸騰中のWebGLに手を出しました。<br>WebGLとは、軽くて速くてぬるぬる動く、うわさのブラウザグラフィックAPIです。<br>具体的に何ができるのか。この作品にどんな技術を取り込んだのか。<br>まずはWebGLの十八番<b>3Dレンダリング</b>、リアルな表現に欠かせない<b>GLSLシェーディング</b>についてご紹介します。
          </p>
          <div class="canvases">
            <div class="canvas"></div>
            <div class="canvas"></div>
            <div class="canvas"></div>
          </div>
          <img src="images/ill.png" alt="">
          <div>
            <h3>3Dレンダリング</h3>
            <p>WebGLには、初心者に優しい奇跡のラッパーライブラリ「three.js」が存在します。これに用意されているメソッドを引用しまくるだけで簡単にWebGLを実装できるのです。<br>使い方はシンプルで、シーンを用意しカメラやオブジェクトを投げ、指定したキャンバスにレンダリングするだけ。あとは毎フレーム描画のお願いをしてあげれば、ブラウザ上でグリグリ動いてくれます。<br>例えばこの作品集には複数のレンダラーがあり、それぞれ別の描画処理をします。各レンダラーに複数用意したキャンバスを指定してやることで、このようにいくつもの作品を１つのWebページ内に共存させることができます。</p>
          </div>
          <div>
            <h3>GLSLシェーディング</h3>
            <p>（´-`）.｡oO リアルタイムで山を作りたい...作ったはいいけどテクスチャ貼るだけじゃのっぺりする...<br>（´ཀ`）.｡oO もっと凹凸感が欲しい...遠くにあるのはぼやけてた方がリアルっぽい...<br><br>といったわがままを全部実現してくれるのがGLSL。もともとWebGLはOpenGLをブラウザ用に改良したもの。OpenGLのシェーディング言語であるGLSLは、当然WebGLでも使えます。<br>three.jsはお手軽なライブラリなので、複雑な処理は用意されてません。凝ったマテリアルが欲しいなら、生のシェーダ使って自分で作るしかないです。というわけで活躍してくれたのが「GLSL」です。<br>頭が痛くなるような行列の数々、思わず目が滑るコード群が特徴です。<br>e.x.</p>
            <p id="scroll">var p = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10,
              23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87,
              174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211,
              133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208,
              89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5,
              202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119,
              248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232,
              178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249,
              14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205,
              93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];<br>~<br>noise: function(x, y, z) {<br>

              var floorX = ~~x,<br>
              floorY = ~~y,<br>
              floorZ = ~~z;<br>

              var X = floorX & 255,<br>
              Y = floorY & 255,<br>
              Z = floorZ & 255;<br>

              x -= floorX;<br>
              y -= floorY;<br>
              z -= floorZ;<br>

              var xMinus1 = x - 1,<br>
              yMinus1 = y - 1,<br>
              zMinus1 = z - 1;<br>

              var u = fade(x),<br>
              v = fade(y),<br>
              w = fade(z);<br>

              var A = p[X] + Y,<br>
              AA = p[A] + Z,<br>
              AB = p[A + 1] + Z,<br>
              B = p[X + 1] + Y,<br>
              BA = p[B] + Z,<br>
              BB = p[B + 1] + Z;<br>

              return lerp(w, lerp(v, lerp(u, grad(p[AA], x, y, z),<br>
              grad(p[BA], xMinus1, y, z)),<br>
              lerp(u, grad(p[AB], x, yMinus1, z),<br>
              grad(p[BB], xMinus1, yMinus1, z))),<br>
              lerp(v, lerp(u, grad(p[AA + 1], x, y, zMinus1),<br>
              grad(p[BA + 1], xMinus1, y, z - 1)),<br>
              lerp(u, grad(p[AB + 1], x, yMinus1, zMinus1),<br>
              grad(p[BB + 1], xMinus1, yMinus1, zMinus1))));<br>

              }</p>
          </div>
        </div>
      </div>

      <div id="canvas2">
        <div class="explain">
          <h2>作品②パーティクルの大量生成と流体表現</h2>
          <p>作品①では3D空間を生成することができました。ですがWebGLはそれだけではありません。<br>重力計算を加えよりリアルな世界に近づけたり、逆に2D空間を演出することもできます。</p>
          <div>
            <img src="images/liquidfun.png" alt="">
            <h3>パーティクルの大量生成 / 流体表現</h3>
            <p>jsには多様なライブラリが存在しています。それはWebGLにおいても同様で、なんと物理演算を行ってくれるライブラリも多数存在します。この作品に適用しているのはGoogle社開発の「LiquidFun.js」です。<br><br>意外につまづいたのが、壁を生成する段階。重力のある世界を作った後、その境界をキャンバスサイズと同じに揃え、事実上の壁を作ろうとしました。<br>しかし取得したキャンバスサイズをそのまま渡すだけでは一致せず、キャンバスの大きさを超えて世界が広がってしまう不具合に見舞われました。<br>原因は単位の違いでした。cssからの流れでピクセル(px)で処理を行っていましたが、「liquidfun.js」で採用されている単位はメートル(m)。ここの換算処理を最初に行うことで解決しました。<br><br><br><br><br><br></p>
          </div>
          <div>
            <img src="images/pixi.png" alt="">
            <h3>2D表現 / 膨大な物量の描画</h3>
            <p>Goodboy Digital社が配布しているjsライブラリ「pixi.js」を用いることで、大量の物体を動かすアニメーションを軽量に動作させられます。またキャンバス要素を応用してテクスチャを作成し、2D表現することもできます。<br><br>苦労したのはもちろんliquidfun.jsとの連携。liquidfun.jsで作りに作ったパーティクルをこちら側pixi.jsに渡し、テクスチャを被せた上で正しく流体演算も行うというもの。<br>作った時点で一括で配列を渡してやればいいと高を括っていたところ、物理演算のためには逐一パーティクルの位置情報を取得しなければならないと判明。（よくよく考えなくても当たり前）<br>粒子やテクスチャなどの要素の生成・適用のタイミング、そして毎フレームの処理に神経を使いました。</p>
          </div>
        </div>
      </div>

      <div id="canvas3">
        <div id="map"></div>
        <div class="explain">
          <h2>作品③地図API</h2>
          <p>事業を紹介するようなWebページでは、所在地を示すために地図を埋め込んでいる場合が多くあります。<br>そのマップに対してもWebGLを適用することができます。</p>
          <div>
            <img src="images/leaflet.png" alt="" class="threeimg">
            <h3>leaflet</h3>
            <p>「leaflet」は地図開発に役立つjsライブラリです。<br>HTML上のmapオブジェクトにタイルレイヤーを追加することで、2Dマップを表示することができます。またズーム操作やマーカーポップなど、地図に搭載したい基本的な機能を提供してくれます。<br><br></p>
          </div>
          <div>
            <img src="images/eegeo.png" alt="" class="threeimg">
            <h3>eegeo.js</h3>
            <p>「eegeo.js」はleafletをベースにした3DマップAPIです。これは3Dマップシステムをオープンソースで提供してくれるeeGeoというサービスの一環です。<br>これのWebGL上での運用はleafletに根ざしているので、leafletを十分に扱うことができ、APIキーを問題なく取得できれば、実装に詰まることはありません。<br><br></p>
          </div>
          <div id="miku">
            <img src="images/miku.png" alt="">
            <h3>今後やりたいこと</h3>
            <p>現実の地図として使えるだけでなく、ゲームの舞台としても違和感のないテクスチャでマッピングされています。この世界に3Dモデルのキャラクタを投入すれば冒険させることができるし、物理演算を組み込んで気候や交通量のシミュレーションを行うこともできます。<br>現実から大量の情報を得られる点で、他のWebGL表現にはない表現もできるはずです。例えば位置情報を利用するAR技術や、昨今発展中のWebARとの連携など。<br>そういった別の技術との組み合わせで、より多彩な表現を実現する開発を今後は行っていきたいと考えています。<br><br><br><br></p>
            <div>(投入待ち)</div>
          </div>
        </div>
      </div>

    </div>

    <ul class="sideWebgl">
      <li><a href="#canvas1"><img src="images/terrain1.png"></a></li>
      <li><a href="#canvas2"><img src="images/2d.png"></a></li>
      <li><a href="#canvas3"><img src="images/map.png"></a></li>
    </ul>

  </main>

</body>
<script>
  var map = L.eeGeo.map('map', "7120c90e922c2b379afbb43a67ea790c", {
    center: [51.517327, -0.120005],
    zoom: 15
  });

</script>

</html>
